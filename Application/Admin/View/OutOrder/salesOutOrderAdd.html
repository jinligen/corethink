<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <link rel="stylesheet" href="__PUBLIC__/libs/layui/css/layui.css" media="all">
    <script language="javascript" src="__PUBLIC__/libs/print/LodopFuncs.js"></script>
    <link rel="stylesheet" href="__ADMIN_CSS__/common.css"  >
    <style id="style1">


        .nav-btn {
            display: flex;
            flex-direction: row;
            justify-content: flex-end;
            align-items: center;
            margin-top: 30px;
        }

        .form-head-row {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            flex-wrap: nowrap;
            margin-bottom: 5px;
            padding: 0 20px;
            font-size: 14px
        }

        .form-head-row .form-item {
            flex: 1;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
        }

        .form-head-row .form-item .title {
            flex: 1;

        }

        .form-head-row .form-item .input-content {
            position: relative;
            flex: 2.5;
        }

        .form-head-row .form-item .input-content .data-show {
            width: 100%;
        }

        #table thead tr th, #table tr td {
            /*padding: 0 !important;*/
            border: solid 1px black;
            text-align: center;
            font-size: 14px
        }

        tr td div {
            position: relative;
            display: inline-block;
            height: 100%;
            width: 100%;
            margin: 0;
        }

        .data-select input, .data-select select {
            display: block;
            margin: 0;
            width: 100%;
            height: 26px;
            border: none;
        }

        .data-select i {
            position: absolute;
            z-index: 11;
            right: 0px;
            top: 3px;
            background-color: #eee;
            border-radius: 3px;
            cursor: pointer;
            height: 20px;
            line-height: 20px;
            width: 30px;
            text-align: center;
        }


    </style>

</head>
<body>


<div class=" " id="page" style="width: 750px;margin: 0 20%;display: none">

    <div class=" demoTable nav-btn ">
        <button class="layui-btn layui-btn-small   " @click="goBack()">返回</button>
        &nbsp;
        <button class="layui-btn layui-btn-primary layui-btn-small" @click="selectSalesOrderList()">生成</button>
        &nbsp;
        <button class="layui-btn layui-btn-normal layui-btn-small" @click="save()">保存</button>
        &nbsp;
        <button class="layui-btn layui-btn-primary layui-btn-small" @click="print()">打印</button>
    </div>

    <div id="div1">

        <div class="layui-row" style=" text-align: center">
            <span style="display: inline-block;font-size: 24px;border-bottom: 2px solid #000;margin: 10px auto;text-decoration:underline">销&nbsp;&nbsp;售&nbsp;&nbsp;出&nbsp;&nbsp;库&nbsp;&nbsp;单</span>
        </div>

        <div class="form-head-row">
            <div class="form-item " style="">
                <span class="title" style="">客&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;户:</span>
                <div class="input-content " @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                    <div class="data-show" style="">&nbsp;{{headInfo.customer_name}}</div>
                    <div class="data-select" style="display: none;width: 100%;">
                        <input type="text" style="" v-model="headInfo.customer_name"/>
                        <i class="layui-icon" style="font-size: 12px; color: #1E9FFF;" @click="selectCustomerList()">
                            &#xe615;</i>
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">日&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;期:</span>
                <div class="input-content ">
                    <div class="data-select" style="width: 100%;">
                        <input type="date" id="date" style="" v-model="headInfo.out_order_date"/>
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">单据编号:</span>
                <div class="input-content ">
                    <div class="data-select" style="width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_id" readonly
                               @change="checkOrderId(headInfo.out_order_id)"/>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-head-row">
            <div class="form-item " style="">
                <span class="title" style="">发票类型:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <select v-model="headInfo.invoice_type">
                            <option value="">请选择</option>
                            <volist name="_invoice_type" id="vo">
                                <option value="{$vo}">{$vo}</option>
                            </volist>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-item " style="">
                <span class="title" style="">支付方式:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <div class="input-content " @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                            <div class="data-show" style="">&nbsp;{{headInfo.out_order_payment_way}}</div>
                            <div class="data-select" style="display: none;width: 100%;">
                                <input type="text" style="" v-model="headInfo.out_order_payment_way"/>
                                <i class="layui-icon" style="font-size: 12px; color: #1E9FFF;" @click="selectPaymentWayList()">
                                    &#xe615;</i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">支付账户:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_payment_account"/>
                    </div>
                </div>
            </div>

        </div>

        <div class="form-head-row">
            <div class="form-item " style="">
                <span class="title" style="">所属仓库:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <select v-model="headInfo.storehouse_name">
                            <option value="">请选择</option>
                            <volist name="_storehouse_name" id="vo">
                                <option value="{$vo}">{$vo}</option>
                            </volist>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-item " style="">
                <span class="title" style="">税&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;率:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <input type="number" style=" width: 80px;display: inline-block;text-align: center" v-model="headInfo.out_order_tax_rate"/>%
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">税&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;额:</span>
                <div class="input-content ">
                    <span style="display: none">{{headInfo.out_order_including_tax_price=parseFloat(headInfo.out_order_price*headInfo.out_order_tax_rate/100).toFixed(2)}}</span>
                    <div class="data-select" style=" width: 100%;">
                        <input type="number" style="" v-model="headInfo.out_order_including_tax_price"/>
                    </div>
                </div>
            </div>

        </div>
        <div class="form-head-row">

            <div class="form-item " style="">
                <span class="title" style="">单据金额:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_price"/>
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">预收金额:</span>
                <div class="input-content ">

                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_before_payment"/>
                    </div>
                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">应收金额:</span>
                <div class="input-content ">
                    <span style="display: none">{{headInfo.out_order_account_receivable=(parseFloat(headInfo.out_order_price) + parseFloat(headInfo.out_order_including_tax_price) - parseFloat(headInfo.out_order_before_payment==''?0:headInfo.out_order_before_payment)).toFixed(2)}}</span>

                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_account_receivable"/>
                    </div>
                </div>
            </div>


        </div>
        <div class="form-head-row">
            <div class="form-item " style="">
                <span class="title" style="">联&nbsp;&nbsp;系&nbsp;&nbsp;人:</span>
                <div class="input-content "  >
                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.customer_contacts"/>
                    </div>
                </div>
            </div>
            <div class="form-item " style="">
                <span class="title" style="">电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话:</span>
                <div class="input-content "  >
                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.customer_phone"/>
                    </div>

                </div>
            </div>

            <div class="form-item " style="">
                <span class="title" style="">本次收款:</span>
                <div class="input-content ">
                    <div class="data-select" style=" width: 100%;">
                        <input type="number" style="" v-model="headInfo.out_order_actual_payment"/>
                    </div>
                </div>
            </div>


        </div>
        <div class="form-head-row">

            <div class="form-item " style="">
                <span class="title" style="">摘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要:</span>
                <div class="input-content "  >

                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.out_order_remark"/>
                    </div>

                </div>
            </div>
            <div class="form-item " style="flex: 1">
                <span class="title" style="flex: 1">&nbsp;</span>
                <div class="input-content " style=" flex: 9">
                    <div class="data-select" style=" width: 100%;">
                        &nbsp;
                    </div>
                </div>
            </div>
            <div class="form-item " style="flex: 1">
                <span class="title" style="flex: 1">过磅重量:</span>
                <div class="input-content " >
                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="weight"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-head-row">

            <div class="form-item " style="flex: 1">
                <span class="title" style="flex: 1">地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址:</span>
                <div class="input-content " style=" flex: 9">

                    <div class="data-select" style=" width: 100%;">
                        <input type="text" style="" v-model="headInfo.customer_address"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="div2">
        <div class="layui-form layui-border-box layui-table-view" style="width:750px; ">
            <div class="layui-table-header" id="fixed-header">
                <table cellspacing="0" cellpadding="0" border="0" class="layui-table">
                    <thead>
                    <tr>
                        <th v-for="(item, index) in thead">
                            <div :style="{ width: item.width + 'px'}">
                                {{item.title}}
                            </div>
                        </th>

                        <th class="on-print">
                            <div class="layui-table-cell laytable-cell-2-18" align="center"><span>操作</span></div>
                        </th>

                    </tr>
                    </thead>
                </table>
            </div>

            <div class="layui-table-body layui-table-main" style="height:450px; " id="scroll">

                <table cellspacing="0" cellpadding="0" border="0" class="layui-table" lay-size="sm">

                    <tbody>
                    <tr v-for="(item, index) in tableInfo">
                        <td>
                            <div :style="{ width: thead[0].width  + 'px',textAlign:'center'}">
                                {{index}}
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[1].width + 'px'}"
                                 @click="dataInputShow($event)" @mouseleave="dataInputHide($event)"
                                 style="height: 26px">
                                <div class="data-show">&nbsp;{{item.goods_id}}</div>
                                <div class="data-select" style="display: none;">
                                    <input type="text" v-model="item.goods_id" readonly/>

                                </div>
                            </div>
                        </td>

                        <td>
                            <div class="input-content " :style="{ width: thead[2].width + 'px'}" >
                                <div class="data-show">&nbsp;{{item.goods_name}}</div>
                                <div class="data-select" style="display: none;">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[3].width + 'px'}" >
                                <div class="data-show">&nbsp;{{item.goods_spec}}</div>
                                <div class="data-select" style="display: none;">
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[4].width + 'px'}"
                                 @click="selectUnit($event,index)" @mouseleave="dataInputHide($event)">
                                <div class="data-show">&nbsp;{{item.goods_actual_unit=item.goods_actual_unit!=''?item.goods_actual_unit:item.goods_min_unit}}</div>
                                <div class="data-select" style="display: none;">
                                    <select class="unit" @change="unitChang($event,index)">


                                    </select>
                                </div>
                            </div>
                        </td>

                        <td>
                            <div class="input-content " :style="{ width: thead[6].width + 'px'}"
                                 @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                                <div class="data-show">&nbsp;{{item.goods_out_total_quantity}}</div>
                                <div class="data-select" style="display: none;">
                                    <input type="number" v-model="item.goods_out_total_quantity"
                                           @change="quantityChang(index)"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[6].width + 'px'}">
                                <div class="data-show">&nbsp;{{(item.goods_weight=item.goods_id!=''?item.goods_weight:'')+item.goods_min_unit}}</div>

                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[5].width + 'px'}"
                                 @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                                <div class="data-show">&nbsp;{{item.goods_out_unit_price}}
                                </div>
                                <div class="data-select" style="display: none;">
                                    <input type="number" v-model="item.goods_out_unit_price"
                                           @change="unitPriceChang(index)"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[7].width + 'px'}"
                                 @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                                <div class="data-show">&nbsp;{{item.goods_out_total_price}}
                                </div>
                                <div class="data-select" style="display: none;">
                                    <input type="number" v-model="item.goods_out_total_price"
                                           @change="totalPriceChang(index)"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="input-content " :style="{ width: thead[8].width + 'px'}"
                                 @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                                <div class="data-show">&nbsp;{{item.goods_remark}}</div>
                                <div class="data-select" style="display: none;">
                                    <input type="text" v-model="item.goods_remark"/>
                                </div>
                            </div>
                        </td>
                        <td :style="{ width: thead[0].width  + 'px',textAlign:'center'}">
                            <div class="layui-table-cell laytable-cell-2-18">
                                <a class="layui-btn layui-btn-danger layui-btn-mini" @click="deleteItem(index)">删除</a>
                            </div>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
            <div class="layui-table-fixed layui-table-fixed-l">
                <div class="layui-table-header">
                    <table cellspacing="0" cellpadding="0" border="0" class="layui-table" lay-size="sm">
                        <thead>
                        <tr>
                            <th :style="{ width: thead[0].width  + 'px',textAlign:'center'}">
                                <div class="input-content " style="height: 28px;line-height: 28px">
                                    <div class="data-show">&nbsp;ID</div>
                                </div>
                            </th>

                            <th :style="{ width: thead[1].width  + 'px',textAlign:'left '}">
                                <div class="input-content " style="height: 28px;line-height: 28px">
                                    <div class="data-show">商品编号</div>
                                </div>
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>
                <div class="layui-table-body" style="height: 435px; ">
                    <table cellspacing="0" cellpadding="0" border="0" class="layui-table" lay-size="sm">
                        <tbody>
                        <tr v-for="(item, index) in tableInfo">
                            <td :style="{ width: thead[0].width  + 'px',textAlign:'center'}">
                                <div class="input-content " style="height: 26px;">
                                    <div class="data-show">&nbsp; {{index+1}}</div>
                                </div>
                            </td>
                            <td :style="{ width: thead[1].width  + 'px',textAlign:'center',backgroundColor:'' }">

                                <div class="input-content " style="height: 26px;" @click="dataInputShow($event)"
                                     @mouseleave="dataInputHide($event)">
                                    <div class="data-show" style="">&nbsp;{{item.goods_id}}</div>
                                    <div class="data-select" style="display: none;width: 100%;">
                                        <input type="text" style="" v-model="item.goods_id" readonly/>

                                        <i class="layui-icon" style="font-size: 12px; color: #1E9FFF;"
                                           @click="selectGoodsList()">&#xe615;</i>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            <div class="layui-table-fixed layui-table-fixed-r" style="right: 0px;">
                <div class="layui-table-header">
                    <table cellspacing="0" cellpadding="0" border="0" class="layui-table" lay-size="sm">
                        <thead>
                        <tr>
                            <th :style="{ width: 80  + 'px',textAlign:'center'}">

                                <div class="input-content " style="height: 28px;">
                                    <div class="data-show">操作</div>
                                </div>
                            </th>
                        </tr>
                        </thead>
                    </table>
                    <div class="layui-table-mend"></div>
                </div>
                <div class="layui-table-body" style="height: 434px; ">
                    <table cellspacing="0" cellpadding="0" border="0" class="layui-table" lay-size="sm">
                        <tbody>
                        <tr v-for="(item, index) in tableInfo">
                            <td :style="{ width: 80  + 'px',textAlign:'center'}">
                                <div class="layui-table-cell laytable-cell-2-18">
                                    <a class="layui-btn layui-btn-danger layui-btn-mini"
                                       @click="deleteItem(index)">删除</a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>


            <div class="form-head-row" style="margin: 10px auto">
                <div class="form-item " style="">
                    <span class="title" style="">部门:</span>
                    <div class="input-content " @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                        <div class="data-show" style="">&nbsp;{{headInfo.department}}</div>
                        <div class="data-select" style="display: none;width: 100%;">
                            <input type="text" style="" v-model="headInfo.department"/>
                            <i class="layui-icon" style="font-size: 12px; color: #1E9FFF;" @click="selectDepartmentList()">
                                &#xe615;</i>
                        </div>
                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">业务员:</span>
                    <div class="input-content " @click="dataInputShow($event)" @mouseleave="dataInputHide($event)">
                        <div class="data-show" style="">&nbsp;{{headInfo.clerk_name}}</div>
                        <div class="data-select" style="display: none;width: 100%;">
                            <input type="text" style="" v-model="headInfo.clerk_name"/>
                            <i class="layui-icon" style="font-size: 12px; color: #1E9FFF;" @click="selectClerkList()">
                                &#xe615;</i>
                        </div>
                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">制单人:{$_user_auth.nickname}</span>
                </div>
                <div class="form-item " style="">
                    <span class="title" style="">审核时间:{{headInfo.audited_date}}</span>
                </div>
            </div>


        </div>
        <div>
            <div  style="text-align: left;margin-left: 20px;margin-top: 30px">
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    公司名称：XXXXX有限公司
                </div>
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    联系电话：0791-5687235
                </div>
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    地址：XXXX路205号
                </div>
            </div>
        </div>


    </div>

    <div class="print-content" style="display: none ">
        <div id="print-headinfo">
            <div class="layui-row" style=" text-align: center">
                <span style="display: inline-block;font-size: 24px;border-bottom: 2px solid #000;margin: 10px auto;text-decoration:underline">销&nbsp;&nbsp;售&nbsp;&nbsp;出&nbsp;&nbsp;库&nbsp;&nbsp;单</span>
            </div>

            <div class="form-head-row">
                <div class="form-item " style="">
                    <span class="title" style="">客&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;户:</span>
                    <div class="input-content "  >
                        <div class="data-show" style="">&nbsp;{{headInfo.customer_name}}</div>
                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">日&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;期:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_date}}</div>
                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">单据编号:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_id}}</div>

                    </div>
                </div>
            </div>

            <div class="form-head-row">
                <div class="form-item " style="">
                    <span class="title" style="">发票类型:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.invoice_type}}</div>

                    </div>
                </div>
                <div class="form-item " style="">
                    <span class="title" style="">支付方式:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_payment_way}}</div>

                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">支付账户:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_payment_account}}</div>

                    </div>
                </div>

            </div>

            <div class="form-head-row">
                <div class="form-item " style="">
                    <span class="title" style="">所属仓库:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.storehouse_name}}</div>

                    </div>
                </div>
                <div class="form-item " style="">
                    <span class="title" style="">税&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;率:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_tax_rate}}</div>

                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">税&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;额:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_including_tax_price}}</div>

                    </div>
                </div>

            </div>
            <div class="form-head-row">

                <div class="form-item " style="">
                    <span class="title" style="">单据金额:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_price}}</div>
                    </div>
                </div>

                <div class="form-item " style="">
                    <span class="title" style="">预收金额:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_before_payment}}</div>

                    </div>

                </div>
                <div class="form-item " style="">
                    <span class="title" style="">应收金额:</span>
                    <div class="input-content ">

                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_account_receivable}}</div>

                    </div>

                </div>



            </div>
            <div class="form-head-row">
                <div class="form-item " style="">
                    <span class="title" style="">联&nbsp;&nbsp;系&nbsp;&nbsp;人:</span>
                    <div class="input-content "  >
                        <div class="data-show" style="">&nbsp;{{headInfo.customer_contacts}}</div>
                    </div>
                </div>
                <div class="form-item " style="">
                    <span class="title" style="">电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话:</span>
                    <div class="input-content "  >
                        <div class="data-show" style="">&nbsp;{{headInfo.customer_phone}}</div>
                    </div>
                </div>


                <div class="form-item " style="">
                    <span class="title" style="">本次收款:</span>
                    <div class="input-content ">
                        <div class="data-show" style="">&nbsp;{{headInfo.out_order_actual_payment}}</div>

                    </div>
                </div>


            </div>
            <div class="form-head-row">

                <div class="form-item " style="">
                    <span class="title" style="">摘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;要:</span>
                    <div class="input-content "  >
                        <div class="data-select" style=" width: 100%; ">
                            {{headInfo.out_order_remark}}
                        </div>

                    </div>
                </div>

                <div class="form-item " style="flex: 2.05">
                    <span class="title" style="max-width:70px">地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址:</span>
                    <div class="input-content " style="">
                        <div class="data-show" style=" width: 100%;text-align: left;">&nbsp;{{headInfo.customer_address}}</div>
                    </div>
                </div>

            </div>

        </div>
        <div id="print-table">
            <table border=1 cellSpacing=0 cellPadding=1 width="100%" style="border-collapse:collapse;"
                   bordercolor="#333333">
                <thead>
                <tr>
                    <td width="5%">
                        <div align=center><b>序号</b></div>
                    </td>
                    <td width="15%">
                        <div align=center><b>商品编号</b></div>
                    </td>
                    <td width="20%">
                        <div align=center><b>名称</b></div>
                    </td>
                    <td width="10%">
                        <div align=center><b>规格</b></div>
                    </td>

                    <td width="5%">
                        <div align=center><b>单位</b></div>
                    </td>
                    <td width="5%">
                        <div align=center><b>数量</b></div>
                    </td>
                    <td width="10%">
                        <div align=center><b>重量</b></div>
                    </td>
                    <td width="5%">
                        <div align=center><b>单价</b></div>
                    </td>

                    <td width="10%">
                        <div align=center><b>金额</b></div>
                    </td>
                    <td width="15%">
                        <div align=center><b>备注</b></div>
                    </td>
                </tr>
                </thead>
                <tbody>
                <tr v-for="(item, index) in tableInfo">
                    <td>
                        {{index + 1}}
                    </td>
                    <td>
                        {{item.goods_id}}
                    </td>
                    <td>
                        {{item.goods_name}}
                    </td>
                    <td>
                        {{item.goods_spec}}
                    </td>
                    <td>
                        {{item.goods_actual_unit}}
                    </td>
                    <td>
                        {{item.goods_out_total_quantity}}
                    </td>
                    <td>
                        {{item.goods_weight+item.goods_min_unit}}
                    </td>
                    <td>
                        {{item.goods_out_unit_price}}
                    </td>
                    <td>
                        {{item.goods_out_total_price}}
                    </td>
                    <td>
                        {{item.goods_remark}}
                    </td>
                </tr>
                </tbody>
                <!--<tfoot>-->
                <!--<tr>-->
                    <!--<td ><b>合计</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->
                    <!--<td ><b>{{headInfo.out_order_price}}</b></td>-->
                    <!--<td ><b>&nbsp;</b></td>-->

                <!--</tr>-->
                <!--</tfoot>-->
            </table>
        </div>
        <div   id="table-foot">
            <div  style="text-align: left;margin-left: 20px;margin-top: 10px">
                <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                    部门: {{headInfo.department}}
                </div>
                <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                    业务员: {{headInfo.clerk_name}}
                </div>
                <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                    制单人: {$_user_auth.nickname}
                </div>
                <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                    审核时间: {{headInfo.audited_date}}
                </div>
            </div>
        </div>

        <div id="table-foot1">
            <div  style="text-align: left;margin-left: 20px;margin-top: 30px">
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    公司名称：XXXXX有限公司
                </div>
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    联系电话：0791-5687235
                </div>
                <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                    地址：XXXX路205号
                </div>
            </div>
        </div>

    </div>

</div>


</body>

<script src="__PUBLIC__/libs/jquery/2.x/jquery.js"></script>
<script src="__PUBLIC__/libs/vue/vue.js"></script>
<!--<script src="__PUBLIC__/libs/layui/layui.js" charset="utf-8"></script>-->
<script src="__PUBLIC__/libs/layer/layer.js" charset="utf-8"></script>
<script type="text/javascript" src="__ADMIN_JS__/common.js"></script>

<script>
    setTimeout(function () {
        $('#page').show()
    },1000);
    var LODOP; //声明为全局变量

    var thead = [ //标题栏
        {title: 'ID', width: 50},
        {title: '商品编号', width: 100},
        {title: '名称', width: 100},
        {title: '规格', width: 100},
        {title: '单位', width: 100},
        {title: '数量', width: 100},
        {title: '重量', width: 100},
        {title: '单价', width: 100},
        {title: '金额', width: 100},
        {title: '备注', width: 100}

    ];
    var _data = {
        scrollTop: 0,
        scrollLeft: 0,
        isSave: true,
        thead: thead,
        weight:0,
        headInfo: {
            out_order_type_name: '{$out_order_type_name}',
            customer_id: '',
            customer_name: '',
            customer_contacts: '',
            customer_phone: '',
            customer_address: '',
            out_order_date: '',
            out_order_id: '{$_order_id}',
            storehouse_name: '',
            out_order_price: '',
            out_order_actual_payment: '',
            out_order_remark: '',
            out_order_tax_rate:0,
            out_order_including_tax_price:0,
            out_order_account_receivable:0,
            out_order_before_payment:0,
            invoice_type:'',
            out_order_payment_way:'',
            out_order_payment_account:'',
            department:'',
            clerk_id:'',
            clerk_name:'',
        },
        tableInfo: [],
        tableData: []
    };

    var _sum_weight = 0;
    var _sum_weight_standard = 0;
    var vm = new Vue({
        el: '#page',
        data: _data,
        watch: {
            weight:{
                handler: function (val, oldVal) {
                    if(val != _sum_weight){
                        layer.msg('过磅重量与合计重量不相等,将进行平摊！')
                        var temp = returnFloat(val)-returnFloat(oldVal);

                        for (var i = 0, leng = this.tableData.length; i < leng; i++) {
                            this.tableData[i].goods_weight  = (returnFloat(this.tableData[i].goods_weight)+ returnFloat(this.tableData[i].goods_weight_standard)/returnFloat(_sum_weight_standard)*temp).toFixed(2);
                        }
                    }
                }
            },
            headInfo: {
                handler: function (val, oldVal) {
                    this.isSave = false;
                },
                deep: true
            },
            tableInfo: {
                handler: function (val, oldVal) {
                    this.isSave = false;
                    this.tableData = [];
                    var out_order_price = 0;
                    _sum_weight = 0;
                    _sum_weight_standard = 0;
                    for (var i = 0, leng = val.length; i < leng; i++) {
                        if (val[i].goods_id != '') {
                            this.tableData.push(val[i]);
                            out_order_price += returnFloat(val[i].goods_out_total_price);
                            _sum_weight +=  returnFloat(val[i].goods_weight);
                            _sum_weight_standard +=  returnFloat(val[i].goods_weight_standard);
                        }
                    }
                    this.weight = _sum_weight;
                    this.headInfo.out_order_price = out_order_price;
                },
                deep: true
            },
            scrollTop: {
                handler: function (val, oldVal) {
                    $('.layui-table-fixed-l .layui-table-body table').css('margin-top', -val + 'px')
                    $('.layui-table-fixed-r .layui-table-body table').css('margin-top', -val + 'px')

                },
            },
            scrollLeft: {
                handler: function (val, oldVal) {
                    $('#fixed-header table').css('margin-left', -val + 'px')
                },
            },
        },
        methods: {
            init: function () {
                this.deleteItem(-1)
            },
            checkOrderId: function (out_order_id) {
                var self = this;
                $.ajax({
                    url: '/corethink/admin.php?s=/admin/public/checkOutOrderId',
                    type: 'POST', //GET
                    async: true,    //或false,是否异步
                    data: {
                        out_order_id: out_order_id,
                    },
                    dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                    beforeSend: function (xhr) {
                    },
                    success: function (data, textStatus, jqXHR) {
                        var data = eval('(' + data + ')');

                        if (data.error == '0000') {

                        } else {
                            layer.msg('单据' + out_order_id + '已存在！');
                            self.headInfo.out_order_id = '';
                        }
                    },
                    error: function (xhr, textStatus) {
                        console.log('错误')
                        console.log(xhr)
                        console.log(textStatus)
                    },
                    complete: function () {
                        console.log('结束')
                    }
                })
            },
            dataInputShow: function (event) {
                var ele = event.currentTarget;
                $(ele).children('div').hide();
                $(ele).children('.data-select').css('display', 'inline-block');
                $(ele).children('.data-select').children('input').focus();
            },
            dataInputHide: function (event) {
                var ele = event.currentTarget;
                $(ele).children('div').hide();
                $(ele).children('.data-show').css('display', 'inline-block');
            },
            Arabia_to_Chinese: function (Num) {
                for (i = Num.length - 1; i >= 0; i--) {
                    Num = Num.replace(",", "")//替换tomoney()中的“,”
                    Num = Num.replace(" ", "")//替换tomoney()中的空格
                }
                Num = Num.replace("￥", "")//替换掉可能出现的￥字符
                if (isNaN(Num)) { //验证输入的字符是否为数字
                    alert("请检查小写金额是否正确");
                    return;
                }
                //字符处理完毕后开始转换，采用前后两部分分别转换
                part = String(Num).split(".");
                newchar = "";
                //小数点前进行转化
                for (i = part[0].length - 1; i >= 0; i--) {
                    if (part[0].length > 10) {
                        alert("位数过大，无法计算");
                        return "";
                    }//若数量超过拾亿单位，提示
                    tmpnewchar = ""
                    perchar = part[0].charAt(i);
                    switch (perchar) {
                        case "0":
                            tmpnewchar = "零" + tmpnewchar;
                            break;
                        case "1":
                            tmpnewchar = "壹" + tmpnewchar;
                            break;
                        case "2":
                            tmpnewchar = "贰" + tmpnewchar;
                            break;
                        case "3":
                            tmpnewchar = "叁" + tmpnewchar;
                            break;
                        case "4":
                            tmpnewchar = "肆" + tmpnewchar;
                            break;
                        case "5":
                            tmpnewchar = "伍" + tmpnewchar;
                            break;
                        case "6":
                            tmpnewchar = "陆" + tmpnewchar;
                            break;
                        case "7":
                            tmpnewchar = "柒" + tmpnewchar;
                            break;
                        case "8":
                            tmpnewchar = "捌" + tmpnewchar;
                            break;
                        case "9":
                            tmpnewchar = "玖" + tmpnewchar;
                            break;
                    }
                    switch (part[0].length - i - 1) {
                        case 0:
                            tmpnewchar = tmpnewchar + "元";
                            break;
                        case 1:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "拾";
                            break;
                        case 2:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "佰";
                            break;
                        case 3:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "仟";
                            break;
                        case 4:
                            tmpnewchar = tmpnewchar + "万";
                            break;
                        case 5:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "拾";
                            break;
                        case 6:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "佰";
                            break;
                        case 7:
                            if (perchar != 0) tmpnewchar = tmpnewchar + "仟";
                            break;
                        case 8:
                            tmpnewchar = tmpnewchar + "亿";
                            break;
                        case 9:
                            tmpnewchar = tmpnewchar + "拾";
                            break;
                    }
                    newchar = tmpnewchar + newchar;
                }
                //小数点之后进行转化
                if (Num.indexOf(".") != -1) {
                    if (part[1].length > 2) {
                        alert("小数点之后只能保留两位,系统将自动截断");
                        part[1] = part[1].substr(0, 2)
                    }
                    for (i = 0; i < part[1].length; i++) {
                        tmpnewchar = ""
                        perchar = part[1].charAt(i)
                        switch (perchar) {
                            case "0":
                                tmpnewchar = "零" + tmpnewchar;
                                break;
                            case "1":
                                tmpnewchar = "壹" + tmpnewchar;
                                break;
                            case "2":
                                tmpnewchar = "贰" + tmpnewchar;
                                break;
                            case "3":
                                tmpnewchar = "叁" + tmpnewchar;
                                break;
                            case "4":
                                tmpnewchar = "肆" + tmpnewchar;
                                break;
                            case "5":
                                tmpnewchar = "伍" + tmpnewchar;
                                break;
                            case "6":
                                tmpnewchar = "陆" + tmpnewchar;
                                break;
                            case "7":
                                tmpnewchar = "柒" + tmpnewchar;
                                break;
                            case "8":
                                tmpnewchar = "捌" + tmpnewchar;
                                break;
                            case "9":
                                tmpnewchar = "玖" + tmpnewchar;
                                break;
                        }
                        if (i == 0) tmpnewchar = tmpnewchar + "角";
                        if (i == 1) tmpnewchar = tmpnewchar + "分";
                        newchar = newchar + tmpnewchar;
                    }
                }
                //替换所有无用汉字
                while (newchar.search("零零") != -1)
                    newchar = newchar.replace("零零", "零");
                newchar = newchar.replace("零亿", "亿");
                newchar = newchar.replace("亿万", "亿");
                newchar = newchar.replace("零万", "万");
                newchar = newchar.replace("零元", "元");
                newchar = newchar.replace("零角", "");
                newchar = newchar.replace("零分", "");
                if (newchar.charAt(newchar.length - 1) == "元" || newchar.charAt(newchar.length - 1) == "角")
                    newchar = newchar + "整"
                return newchar;
            },
            deleteItem: function (index) {

                if (index >= 0) {
                    this.tableInfo.splice(index, 1);
                }
                for (var i = 0; i < this.tableInfo.length; i++) {
                    if (this.tableInfo[i].goods_id === '') {
                        this.tableInfo.splice(i, 1)
                    }
                }


                var leng = this.tableInfo.length % 10 === 0 ? (this.tableInfo.length === 0 ? 10 : 0) : 10 - this.tableInfo.length % 10;


                for (var i = 0; i < leng + 5; i++) {
                    this.tableInfo.push({
                        goods_id: '',
                        goods_name: '',
                        goods_spec: '',
                        goods_actual_unit: '',
                        goods_out_unit_price: '',
                        goods_out_total_quantity: '',
                        goods_out_total_price: '',
                        goods_remark: '',

                        goods_min_unit: '',

                    })
                }

                this.$nextTick(function(){
                    $('body').css('background','#fff');
                    $('#page').css('display','block');
                })

            },
            goBack: function () { //刷新
                if (!this.isSave) {
                    layer.confirm('单据还未保存，确定关闭吗？', {
                        btn: ['取消', '确定'] //按钮
                    }, function () {
                        layer.closeAll();
                    }, function () {
                        location.href = '/corethink/admin.php?s=/admin/OutOrder/salesOutOrder'
                        layer.closeAll();
                    });
                } else {
                    location.href = '/corethink/admin.php?s=/admin/OutOrder/salesOutOrder'
                }
            },
            save: function () { //保存
                var self = this;
                $.ajax({
                    url: '/corethink/admin.php?s=/admin/OutOrder/salesOutOrderAdd',
                    type: 'POST', //GET
                    async: true,    //或false,是否异步
                    data: {
                        headInfo: (self.headInfo),
                        tableInfo: (self.tableData),

                    },
                    dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                    beforeSend: function (xhr) {
                        var flag = true;

                        if (self.headInfo.customer_name == '') {
                            layer.msg('请选择客户');
                            flag = false;
                        } else if (self.headInfo.out_order_date == '') {
                            layer.msg('请选择日期');
                            flag = false;
                        } else if (self.headInfo.out_order_id == '') {
                            layer.msg('请填写单据编号');
                            flag = false;
                        } else if (self.headInfo.storehouse_name == '') {
                            layer.msg('请选择所属仓库');
                            flag = false;
                        } else if (self.headInfo.out_order_price == '') {
                            layer.msg('请填写单据金额');
                            flag = false;
                        } else if (self.tableData.length == '') {
                            layer.msg('请选择商品');
                            flag = false;
                        }  else if (self.headInfo.department == '') {
                            layer.msg('请选择部门');
                            flag = false;
                        } else if (self.headInfo.clerk_name == '') {
                            layer.msg('请选择业务员');
                            flag = false;
                        }  else {
                            for (var i = 0, leng = self.tableData.length; i < leng; i++) {
                                if (self.tableData[i].goods_out_unit_price <= 0) {
                                    layer.msg(self.tableData[i].goods_id + '的单价必须大于0');
                                    flag = false;
                                    break;
                                }
                                if (self.tableData[i].goods_out_total_quantity <= 0) {
                                    layer.msg(self.tableData[i].goods_id + '的数量必须大于0');
                                    flag = false;
                                    break;
                                }
                            }
                        }


                        return flag
                    },
                    success: function (data, textStatus, jqXHR) {
                        var data = eval('(' + data + ')');

                        if (data.error == '0000') {
                            layer.msg('保存成功');
                            self.isSave = true;
                        } else if (data.error == '0002') {
                            layer.msg('已保存！');
                        } else {
                            layer.msg('保存失败');
                        }

                    },
                    error: function (xhr, textStatus) {
                        console.log('错误')
                        console.log(xhr)
                        console.log(textStatus)
                    },
                    complete: function () {
                        console.log('结束')
                    }
                })


            },
            print: function () { //打印
                if (!this.isSave) {
                    layer.msg('单据未保存');
                    return;
                }
                LODOP = getLodop();
                LODOP.PRINT_INIT("打印控件功能演示_Lodop功能_分页打印综合表格");

                var strMainStyle = '<link rel="stylesheet" href="__PUBLIC__/libs/layui/css/layui.css"  media="all">'
                strMainStyle += '<link rel="stylesheet" type="text/css" href="__ADMIN_CSS__/main.css">'
                var strAllStyle = strMainStyle + "<style>" + document.getElementById("style1").innerHTML + "</style>";

                $('.print-content').show()
                LODOP.SET_PREVIEW_WINDOW(1, 2, 0, 1200, 800, "");//打印前弹出选择打印机的对话框
//                LODOP.SET_PRINT_PAGESIZE(1, '35cm', '11cm', 'CreateCustomPage');//纵(正)向打印，固定纸张

                LODOP.ADD_PRINT_TABLE($('#print-headinfo').height() + 30, 0, 750, 400, $("#print-table").html());
                LODOP.SET_PRINT_STYLEA(0, "VOrient", 0);
                LODOP.SET_PRINT_STYLEA(0, "Horient", 2);
                LODOP.ADD_PRINT_HTM( $('#print-headinfo').height() + 400 + 40 , 10, 750, 20, strAllStyle + $("#table-foot").html());
                LODOP.SET_PRINT_STYLEA(0, "VOrient", 0);
                LODOP.SET_PRINT_STYLEA(0, "Horient", 2);
                LODOP.SET_PRINT_STYLEA(0, "ItemType", 1);
                LODOP.SET_PRINT_STYLEA(0, "LinkedItem", 1);
                LODOP.ADD_PRINT_HTM( $('#print-headinfo').height() + 400 + 80 , 10, 750, 20, strAllStyle + $("#table-foot1").html());
                LODOP.SET_PRINT_STYLEA(0, "VOrient", 0);
                LODOP.SET_PRINT_STYLEA(0, "Horient", 2);
                LODOP.SET_PRINT_STYLEA(0, "ItemType", 1);
                LODOP.SET_PRINT_STYLEA(0, "LinkedItem", 1);
                LODOP.ADD_PRINT_HTM(30, 0, 750, 200, strAllStyle + $('#print-headinfo').html());
                LODOP.SET_PRINT_STYLEA(0, "VOrient", 0);
                LODOP.SET_PRINT_STYLEA(0, "Horient", 2);
                LODOP.SET_PRINT_STYLEA(0, "ItemType", 1);
                LODOP.SET_PRINT_STYLEA(0, "LinkedItem", 1);
                $('.print-content').hide()
                LODOP.PREVIEW();
            },
            selectCustomerList: function () {
                var self = this;
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['500px', '560px'],
                    title: '客户列表',
                    content: '/corethink/admin.php?s=/admin/public/customerList/type/客户',
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            self.headInfo.customer_id = retInfo.customer_id;
                            self.headInfo.customer_name = retInfo.customer_name;
                            self.headInfo.customer_contacts = retInfo.customer_contacts;
                            self.headInfo.customer_phone = retInfo.customer_phone;
                            self.headInfo.customer_address = retInfo.customer_address;
                        }

                        console.log(retInfo)
                    }
                });
            },
            selectGoodsList: function () {
                var self = this;
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['800px', '560px'],
                    title: '商品列表',
                    content: '/corethink/admin.php?s=/admin/public/goodsList/goods_type_name/产品',
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            var tableData = [];

                            for (var i = 0; i < self.tableInfo.length; i++) {
                                if (self.tableInfo[i].goods_id != '') {
                                    tableData.push(self.tableInfo[i])
                                }
                            }

                            for (var i = 0, leng = retInfo.length; i < leng; i++) {
                                var j = 0;
                                var l = self.tableInfo.length;

                                for (; j < l; j++) {

                                    if (self.tableInfo[j].goods_id == retInfo[i].goods_id) {
                                        break;
                                    }
                                }
                                console.log(j)
                                if (j == l) {
                                    tableData.push({
                                        goods_id: retInfo[i].goods_id,
                                        goods_name: retInfo[i].goods_name,
                                        goods_spec: retInfo[i].goods_spec,
                                        goods_actual_unit: retInfo[i].goods_min_unit,
                                        goods_out_unit_price: retInfo[i].goods_cost_price,
                                        goods_out_total_quantity: 0,
                                        goods_out_total_price: 0,
                                        goods_rates: retInfo[i].goods_rates,
                                        goods_min_unit: retInfo[i].goods_min_unit,
                                        goods_weight: 0,
                                        goods_remark: '',

                                    });
                                }
                            }
                            console.log(tableData);
                            self.tableInfo = tableData;
                            self.deleteItem(-1);
                        }


                    }
                });
            },
            selectUnit: function (event, index) {
                if (!this.tableInfo[index].goods_id) {
                    return false;
                }
                var ele = event.currentTarget;
                $(ele).children('div').hide();
                $(ele).children('.data-select').css('display', 'inline-block');
                $(ele).children('.data-select').children('input').focus();
                goods_rates = this.tableInfo[index].goods_rates;
                goods_rates = goods_rates.split(',');

                var option = '<option value="">请选择</option>';
                var t;
                for (var i = 0; i < goods_rates.length; i++) {
                    if (goods_rates[i] != '') {
                        t = (goods_rates[i]).split('/')
                        option += '<option value="' + goods_rates[i] + '">' + t[1] + '</option>'
                    }
                }
                $(ele).children('.data-select').children('.unit').children('option').remove();
                $(ele).children('.data-select').children('.unit').append(option);
            },
            unitChang: function (event,index) {

                if (!this.tableInfo[index].goods_id) {
                    return false;
                }

                var item = this.tableInfo[index];
                var ele = event.currentTarget;

                var goods_actual_unit =  $(ele).val().split('/')[1];
                var unit_quantity=  $(ele).val().split('/')[0];
                this.tableInfo[index].goods_actual_unit = goods_actual_unit;

                var goods_weight = goods_actual_unit == item.goods_min_unit ? item.goods_out_total_quantity : unit_quantity * item.goods_out_total_quantity;
                this.tableInfo[index].goods_weight = item.goods_out_total_quantity > 0 ? goods_weight : 0;
                this.tableInfo[index].goods_weight_standard = this.tableInfo[index].goods_weight

            },
            quantityChang: function (index) {

                if (!this.tableInfo[index].goods_id) {
                    return false;
                }

                var item = this.tableInfo[index];
                this.tableInfo[index].goods_out_total_price = parseFloat(item.goods_out_total_quantity > 0 && item.goods_out_unit_price > 0 ? item.goods_out_unit_price * item.goods_out_total_quantity : 0).toFixed(2);


                var goods_rates = (item.goods_rates).split(',');
                var unit_quantity = 0;
                for(var i =0 ;i<goods_rates.length;i++){
                    if (goods_rates[i].split('/')[1] == item.goods_actual_unit) {
                        unit_quantity =  goods_rates[i].split('/')[0];
                        console.log(goods_rates[i].split('/')[1]);
                        console.log(unit_quantity);

                        break;
                    }
                }
                this.tableInfo[index].goods_weight = item.goods_actual_unit == item.goods_min_unit ? item.goods_out_total_quantity : unit_quantity  * item.goods_out_total_quantity;
                this.tableInfo[index].goods_weight_standard = this.tableInfo[index].goods_weight

            },
            unitPriceChang: function (index) {
                if (!this.tableInfo[index].goods_id) {
                    return false;
                }
                var item = this.tableInfo[index];
                this.tableInfo[index].goods_out_total_price = parseFloat(item.goods_out_total_quantity > 0 && item.goods_out_unit_price > 0 ? item.goods_out_unit_price * item.goods_out_total_quantity : 0).toFixed(2);


            },
            totalPriceChang: function (index) {
                if (!this.tableInfo[index].goods_id) {
                    return false;
                }
                var item = this.tableInfo[index];

                this.tableInfo[index].goods_out_unit_price = parseFloat(item.goods_out_total_quantity > 0 && item.goods_out_total_price > 0 ? item.goods_out_total_price / item.goods_out_total_quantity : 0).toFixed(2);


            },
            selectSalesOrderList: function () {
                var self = this;
                if(self.headInfo.customer_id==''){
                    layer.msg('请选择客户！');
                    return false;
                }
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['800px', '560px'],
                    title: '应收账单列表',
                    content: '/corethink/admin.php?s=/admin/public/salesOrderList/customer_id/'+self.headInfo.customer_id,
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            var tableData = [];

                            for (var i = 0; i < self.tableInfo.length; i++) {
                                if (self.tableInfo[i].goods_id != '') {
                                    tableData.push(self.tableInfo[i])
                                }
                            }

                            for (var i = 0, leng = retInfo.length; i < leng; i++) {
                                var j = 0;
                                var l = self.tableInfo.length;

                                for (; j < l; j++) {

                                    if (self.tableInfo[j].goods_id == retInfo[i].goods_id) {
                                        break;
                                    }
                                }
                                console.log(retInfo[i])
                                if (j == l) {
                                    tableData.push({
                                        goods_id: retInfo[i].goods_id,
                                        goods_name: retInfo[i].goods_name,
                                        goods_spec: retInfo[i].goods_spec,
                                        goods_actual_unit: retInfo[i].goods_actual_unit,
                                        goods_out_unit_price: retInfo[i].goods_sales_unit_price,
                                        goods_out_total_quantity: retInfo[i].goods_sales_total_quantity,
                                        goods_out_total_price: retInfo[i].goods_sales_total_price,
                                        goods_rates: retInfo[i].goods_rates,
                                        goods_min_unit: retInfo[i].goods_min_unit,
                                        goods_weight: retInfo[i].goods_weight,
                                        goods_weight_standard: retInfo[i].goods_weight,
                                        goods_remark: retInfo[i].goods_remark,

                                    });
                                }
                            }
                            console.log('22222');
                            console.log(tableData);
                            self.tableInfo = tableData;
                            self.deleteItem(-1);
                        }


                    }
                });
            },
            selectClerkList:function () {
                var self = this;
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['500px', '560px'],
                    title: '业务员列表',
                    content: '/corethink/admin.php?s=/admin/public/clerkList',
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            self.headInfo.clerk_id = retInfo.clerk_id;
                            self.headInfo.clerk_name = retInfo.clerk_name;
                        }

                        console.log(retInfo)
                    }
                });
            },
            selectDepartmentList: function () {
                var self = this;
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['500px', '560px'],
                    title: '部门列表',
                    content: '/corethink/admin.php?s=/admin/public/departmentList',
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            self.headInfo.department = retInfo.customer_name;
                        }

                        console.log(retInfo)
                    }
                });
            },
            selectPaymentWayList:function () {
                var self = this;
                var childPageBody;
                layer.open({
                    type: 2,
                    skin: 'CLYM-style',
                    area: ['500px', '560px'],
                    title: '列表',
                    content: '/corethink/admin.php?s=/admin/public/paymentWayList',
                    success: function (layero, index) {
                        childPageBody = layer.getChildFrame('body', index);//建立父子联系
                    },
                    end: function () {
                        var ret = childPageBody.find('textarea#retData')
                        var retInfo = ret.val()
                        if (retInfo != '') {
                            retInfo = JSON.parse(retInfo)
                            self.headInfo.out_order_payment_way = retInfo.payment_way;
                            self.headInfo.out_order_payment_account = retInfo.payment_account;
                        }

                        console.log(retInfo)
                    }
                });
            }
        }
    })

    vm.init();

    $("#scroll").scroll(function () {
        vm.scrollTop = $(this).scrollTop()
        vm.scrollLeft = $(this).scrollLeft()

    });

    var _closeDate = '{$_closeDate}';
    if(_closeDate && _closeDate!==''){
        $('input[type="date"]').attr('min',getDate(_closeDate));
    }
</script>

</html>
